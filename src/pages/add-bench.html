<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>A√±adir Nuevo Banco - Benchify</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    
    <link rel="stylesheet" href="../assets/css/styles.css">
    <link rel="stylesheet" href="../assets/css/add-bench.css">
    
    <!-- Leaflet para el mapa -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/leaflet.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/leaflet.min.js"></script>
    
    <style>
        #locationMap { 
            height: 300px; 
            border-radius: 10px; 
            margin-top: 10px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            border: 2px solid #e5e7eb;
        }
    </style>
</head>
<body class="bg-gray-50 min-h-screen pb-12">

    <!-- NAVEGACI√ìN -->
    <nav>
        <div class="container">
            <a href="map.html">
                <i class="fas fa-chevron-left"></i> Cancelar
            </a>
            <h1>Registrar Nuevo Banco</h1>
            <div style="width: 80px;"></div>
        </div>
    </nav>

    <!-- CONTENIDO PRINCIPAL -->
    <main>
        <form id="addBenchForm" class="space-y-6">
            
            <!-- Secci√≥n 0: PREGUNTAS INICIALES PARA UBICACI√ìN -->
            <div class="form-section" style="background: linear-gradient(135deg, #dbeafe 0%, #cffafe 100%); border: 2px solid #0284c7;">
                <h2 style="color: #0c4a6e;">üìç Primero, cu√©ntanos d√≥nde est√° el banco</h2>
                <p style="color: #0f766e; font-size: 0.9rem; margin-bottom: 1rem;">Esto nos ayudar√° a centrar el mapa en la zona correcta</p>
                
                <div class="form-group">
                    <label for="ciudad">Ciudad/Municipio <span style="color: #ef4444;">*</span></label>
                    <input 
                        type="text" 
                        id="ciudad" 
                        name="ciudad"
                        placeholder="Ej: Madrid, Barcelona, Valencia..."
                        autocomplete="off"
                    >
                    <div id="ciudadSuggestions" style="margin-top: 0.5rem; display: none; background: white; border: 1px solid #e5e7eb; border-radius: 6px; max-height: 200px; overflow-y: auto; z-index: 100;"></div>
                </div>

                <div class="form-group">
                    <label for="barrio">Barrio/Zona <span style="color: #ef4444;">*</span></label>
                    <input 
                        type="text" 
                        id="barrio" 
                        name="barrio"
                        placeholder="Ej: Centro, Retiro, Chueca..."
                    >
                </div>

                <div class="form-group">
                    <label for="tipoZona">Tipo de Zona <span style="color: #ef4444;">*</span></label>
                    <select id="tipoZona" name="tipoZona" required>
                        <option value="">-- Selecciona un tipo --</option>
                        <option value="parque">üå≥ Parque P√∫blico</option>
                        <option value="playa">üèñÔ∏è Playa/Paseo Mar√≠timo</option>
                        <option value="monta√±a">‚õ∞Ô∏è Monta√±a/Senderismo</option>
                        <option value="urbano">üèôÔ∏è Centro Urbano</option>
                        <option value="arboledas">üå≤ Zona Arbolada/Paseo</option>
                        <option value="riverside">üèûÔ∏è R√≠o/Ribera</option>
                        <option value="otro">‚ùì Otro</option>
                    </select>
                </div>

                <button type="button" id="btnBuscarUbicacion" style="background: #0284c7; color: white; padding: 10px 20px; border: none; border-radius: 6px; cursor: pointer; font-weight: 600; width: 100%; margin-top: 1rem;">
                    <i class="fas fa-search"></i> Buscar y Centrar Mapa
                </button>
            </div>
            
            <!-- Secci√≥n 1: Informaci√≥n B√°sica -->
            <div class="form-section">
                <h2>üìç Informaci√≥n B√°sica</h2>
                
                <div class="form-group">
                    <label for="benchName">Nombre del Lugar <span style="color: #ef4444;">*</span></label>
                    <input 
                        type="text" 
                        id="benchName" 
                        name="benchName"
                        required 
                        placeholder="Ej: El rinc√≥n de los suspiros"
                    >
                </div>
                
                <div class="form-group">
                    <label for="benchDesc">Descripci√≥n Breve</label>
                    <textarea 
                        id="benchDesc" 
                        name="benchDesc"
                        rows="3" 
                        placeholder="Cu√©ntanos por qu√© es especial este banco, qu√© lo hace √∫nico..."
                    ></textarea>
                </div>
            </div>

            <!-- Secci√≥n 1.5: Foto Opcional -->
            <div class="form-section">
                <h2>üì∏ Foto del Banco (Opcional)</h2>
                
                <div class="form-group">
                    <label for="benchPhoto">Sube una imagen (JPG, PNG, WebP - m√°x. 5MB)</label>
                    <input 
                        type="file" 
                        id="benchPhoto" 
                        name="benchPhoto"
                        accept="image/jpeg,image/png,image/webp,image/gif"
                    >
                    
                    <!-- Vista previa de la foto -->
                    <div id="photoPreview" class="photo-preview-container" style="display: none;">
                        <img id="previewImage" src="" alt="Preview">
                        <button type="button" id="removePhotoBtn" class="remove-photo-btn">
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>
                    <div id="photoError" class="form-error" style="display: none;"></div>
                </div>
            </div>

            <!-- Secci√≥n 2: Valoraci√≥n -->
            <div class="form-section">
                <h2>‚≠ê Valoraci√≥n (1 a 5 estrellas) <span style="color: #ef4444;">*</span></h2>
                
                <div class="form-group">
                    <div class="slider-group">
                        <label for="vistas">Calidad de Vistas</label>
                        <input type="range" id="vistas" name="vistas" min="1" max="5" value="3" class="slider-input">
                        <div class="rating-display">
                            <span class="rating-stars" id="stars-vistas">‚òÖ‚òÖ‚òÖ‚òÜ‚òÜ</span>
                            <span class="rating-number" id="val-vistas">3</span>
                        </div>
                    </div>
                </div>

                <div class="form-group">
                    <div class="slider-group">
                        <label for="privacidad">Nivel de Privacidad</label>
                        <input type="range" id="privacidad" name="privacidad" min="1" max="5" value="3" class="slider-input">
                        <div class="rating-display">
                            <span class="rating-stars" id="stars-privacidad">‚òÖ‚òÖ‚òÖ‚òÜ‚òÜ</span>
                            <span class="rating-number" id="val-privacidad">3</span>
                        </div>
                    </div>
                </div>

                <div class="form-group">
                    <div class="slider-group">
                        <label for="comodidad">Comodidad / Dise√±o</label>
                        <input type="range" id="comodidad" name="comodidad" min="1" max="5" value="3" class="slider-input">
                        <div class="rating-display">
                            <span class="rating-stars" id="stars-comodidad">‚òÖ‚òÖ‚òÖ‚òÜ‚òÜ</span>
                            <span class="rating-number" id="val-comodidad">3</span>
                        </div>
                    </div>
                </div>

                <div class="form-group">
                    <div class="slider-group">
                        <label for="atmosfera">Atm√≥sfera</label>
                        <input type="range" id="atmosfera" name="atmosfera" min="1" max="5" value="3" class="slider-input">
                        <div class="rating-display">
                            <span class="rating-stars" id="stars-atmosfera">‚òÖ‚òÖ‚òÖ‚òÜ‚òÜ</span>
                            <span class="rating-number" id="val-atmosfera">3</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Secci√≥n 3: Ubicaci√≥n -->
            <div class="form-section">
                <h2>üìç Ubicaci√≥n <span style="color: #ef4444;">*</span></h2>
                
                <div class="form-group">
                    <label>Haz clic en el mapa para seleccionar la ubicaci√≥n</label>
                    <div id="locationMap"></div>
                    <p style="font-size: 0.9rem; color: #6b7280; margin-top: 0.75rem;">
                        <i class="fas fa-map-marker-alt" style="color: #16a34a;"></i> 
                        Coordenadas: <strong id="coordsDisplay">40.4167, -3.7037</strong>
                    </p>
                </div>
                
                <input type="hidden" id="lat" name="lat" value="40.4167">
                <input type="hidden" id="lng" name="lng" value="-3.7037">
            </div>

            <!-- Secci√≥n 4: Bot√≥n Submit -->
            <button type="submit" id="saveBtn" class="submit-btn">
                <i class="fas fa-cloud-arrow-up"></i> Publicar Banco
            </button>
        </form>
    </main>

    <!-- SCRIPTS -->
    <!-- Primero cargamos Leaflet ANTES del m√≥dulo -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/leaflet.min.js"></script>
    
    <script>
        // Variables globales accesibles
        let selectedPhotoFile = null;
        let map = null;
        let marker = null;

        // BASE DE DATOS DE CIUDADES Y COORDENADAS
        const UBICACIONES_ESP = {
            'madrid': { lat: 40.4168, lng: -3.7038, zoom: 13, nombre: 'Madrid' },
            'barcelona': { lat: 41.3874, lng: 2.1686, zoom: 13, nombre: 'Barcelona' },
            'valencia': { lat: 39.4699, lng: -0.3763, zoom: 13, nombre: 'Valencia' },
            'sevilla': { lat: 37.3886, lng: -5.9823, zoom: 13, nombre: 'Sevilla' },
            'bilbao': { lat: 43.2633, lng: -2.9349, zoom: 13, nombre: 'Bilbao' },
            'malaga': { lat: 36.7213, lng: -4.4214, zoom: 13, nombre: 'M√°laga' },
            'murcia': { lat: 37.9922, lng: -1.1307, zoom: 13, nombre: 'Murcia' },
            'alicante': { lat: 38.3452, lng: -0.4810, zoom: 13, nombre: 'Alicante' },
            'cordoba': { lat: 37.8882, lng: -4.7794, zoom: 13, nombre: 'C√≥rdoba' },
            'toledo': { lat: 39.8562, lng: -4.0235, zoom: 13, nombre: 'Toledo' },
            'palma': { lat: 39.5696, lng: 2.6502, zoom: 13, nombre: 'Palma de Mallorca' },
            'zaragoza': { lat: 41.6488, lng: -0.8891, zoom: 13, nombre: 'Zaragoza' },
            'leon': { lat: 42.5987, lng: -5.5794, zoom: 13, nombre: 'Le√≥n' },
            'salamanca': { lat: 40.9701, lng: -5.6635, zoom: 13, nombre: 'Salamanca' },
            'oviedo': { lat: 43.3614, lng: -5.8400, zoom: 13, nombre: 'Oviedo' },
            'santiago': { lat: 42.8806, lng: -8.5456, zoom: 13, nombre: 'Santiago de Compostela' },
            'burgos': { lat: 42.3367, lng: -3.6993, zoom: 13, nombre: 'Burgos' },
            'valladolid': { lat: 41.6523, lng: -4.7245, zoom: 13, nombre: 'Valladolid' },
            'logro√±o': { lat: 42.4627, lng: -2.4449, zoom: 13, nombre: 'Logro√±o' },
            'm√©rida': { lat: 38.9184, lng: -6.3736, zoom: 13, nombre: 'M√©rida' }
        };

        // AUTOCOMPLETAR CIUDADES
        function setupAutoComplete() {
            const inputCiudad = document.getElementById('ciudad');
            const suggestionsList = document.getElementById('ciudadSuggestions');

            inputCiudad.addEventListener('input', (e) => {
                const valor = e.target.value.toLowerCase().trim();
                
                if (valor.length < 2) {
                    suggestionsList.style.display = 'none';
                    return;
                }

                const coincidencias = Object.values(UBICACIONES_ESP)
                    .filter(u => u.nombre.toLowerCase().includes(valor))
                    .slice(0, 8);

                if (coincidencias.length === 0) {
                    suggestionsList.style.display = 'none';
                    return;
                }

                suggestionsList.innerHTML = coincidencias
                    .map(u => `<div style="padding: 10px; border-bottom: 1px solid #e5e7eb; cursor: pointer; transition: background 0.2s;" 
                        class="sugg-item" onclick="document.getElementById('ciudad').value = '${u.nombre}'; document.getElementById('ciudadSuggestions').style.display = 'none';"
                        onmouseover="this.style.background = '#f0f9ff';" 
                        onmouseout="this.style.background = 'white';">
                        üìç ${u.nombre}
                    </div>`)
                    .join('');
                
                suggestionsList.style.display = 'block';
            });

            document.addEventListener('click', (e) => {
                if (e.target.id !== 'ciudad') {
                    suggestionsList.style.display = 'none';
                }
            });
        }

        // GENERAR ESTRELLAS
        function generateStars(rating) {
            rating = parseInt(rating);
            let stars = '';
            for (let i = 1; i <= 5; i++) {
                stars += i <= rating ? '‚òÖ' : '‚òÜ';
            }
            return stars;
        }

        // INICIALIZAR MAPA
        function initializeMap(lat = 40.4168, lng = -3.7038, zoom = 13) {
            try {
                console.log('üó∫Ô∏è Iniciando mapa en:', lat, lng, 'Zoom:', zoom);
                
                const mapContainer = document.getElementById('locationMap');
                if (!mapContainer) {
                    console.error('‚ùå Contenedor del mapa no encontrado');
                    return;
                }

                // Si el mapa ya existe, destruirlo
                if (map) {
                    console.log('üóëÔ∏è Destruyendo mapa anterior');
                    map.remove();
                    map = null;
                }

                // Esperar un poco para asegurar limpieza
                setTimeout(() => {
                    try {
                        console.log('‚ú® Creando nuevo mapa...');
                        
                        // Crear mapa
                        map = L.map('locationMap', {
                            center: [lat, lng],
                            zoom: zoom,
                            zoomControl: true,
                            dragging: true,
                            touchZoom: true
                        });
                        
                        // Agregar tiles
                        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                            attribution: '¬© OpenStreetMap contributors',
                            maxZoom: 19
                        }).addTo(map);

                        // Crear marcador
                        marker = L.marker([lat, lng], {
                            draggable: true,
                            title: 'Tu banco est√° aqu√≠'
                        }).addTo(map);

                        marker.bindPopup('Tu banco est√° aqu√≠<br>Arrastra para ajustar la ubicaci√≥n');

                        // Eventos del marcador
                        marker.on('dragend', updateMarkerPosition);

                        // Evento click en el mapa
                        map.on('click', (e) => {
                            marker.setLatLng(e.latlng);
                            updateMarkerPosition();
                        });

                        // Forzar redimensionamiento
                        map.invalidateSize(true);

                        console.log('‚úÖ Mapa inicializado correctamente');
                        updateMarkerPosition();
                    } catch (innerError) {
                        console.error('‚ùå Error al crear mapa:', innerError);
                    }
                }, 50);
                
            } catch (error) {
                console.error('‚ùå Error al inicializar mapa:', error);
            }
        }

        function updateMarkerPosition() {
            if (!marker) return;
            const lat = marker.getLatLng().lat.toFixed(6);
            const lng = marker.getLatLng().lng.toFixed(6);
            
            document.getElementById('lat').value = lat;
            document.getElementById('lng').value = lng;
            document.getElementById('coordsDisplay').textContent = `${lat}, ${lng}`;
        }

        // BUSCAR UBICACI√ìN Y CENTRAR MAPA
        function setupLocationSearch() {
            const btn = document.getElementById('btnBuscarUbicacion');
            if (!btn) {
                console.error('Bot√≥n de b√∫squeda no encontrado');
                return;
            }

            btn.addEventListener('click', async (e) => {
                e.preventDefault();
                
                const ciudad = document.getElementById('ciudad').value.toLowerCase().trim();
                const barrio = document.getElementById('barrio').value.trim();
                const tipoZona = document.getElementById('tipoZona').value;

                if (!ciudad || !tipoZona) {
                    alert('‚ùå Por favor, completa los campos obligatorios');
                    return;
                }

                // Buscar ciudad en base de datos
                const ubicacionBase = UBICACIONES_ESP[ciudad] || Object.values(UBICACIONES_ESP)
                    .find(u => u.nombre.toLowerCase() === ciudad);

                if (!ubicacionBase) {
                    alert('‚ùå Ciudad no encontrada. Por favor, selecciona de la lista de sugerencias');
                    return;
                }

                let lat = ubicacionBase.lat;
                let lng = ubicacionBase.lng;
                let zoom = 13;

                // Si hay barrio, intentar geolocalizar m√°s espec√≠ficamente
                if (barrio) {
                    try {
                        btn.disabled = true;
                        btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Buscando...';

                        const searchUrl = `https://nominatim.openstreetmap.org/search?q=${encodeURIComponent(barrio)},${encodeURIComponent(ubicacionBase.nombre)},Spain&format=json&limit=1`;
                        const response = await fetch(searchUrl);
                        const results = await response.json();
                        
                        if (results.length > 0) {
                            lat = parseFloat(results[0].lat);
                            lng = parseFloat(results[0].lon);
                            zoom = 15;
                            console.log(`‚úÖ Ubicaci√≥n precisada: ${barrio}, ${ubicacionBase.nombre}`);
                        } else {
                            console.log('‚ö†Ô∏è No se encontr√≥ el barrio espec√≠fico, usando ciudad');
                            zoom = 14;
                        }
                    } catch (error) {
                        console.warn('‚ö†Ô∏è Error al buscar barrio espec√≠fico:', error);
                        zoom = 14;
                    }
                }

                // Centrar mapa en la ubicaci√≥n
                initializeMap(lat, lng, zoom);

                btn.disabled = false;
                btn.innerHTML = '<i class="fas fa-search"></i> Buscar y Centrar Mapa';

                // Scroll al mapa
                setTimeout(() => {
                    document.getElementById('locationMap').scrollIntoView({ behavior: 'smooth', block: 'center' });
                    alert(`‚úÖ ¬°Listo! El mapa est√° centrado en ${ubicacionBase.nombre}${barrio ? ', ' + barrio : ''}.\n\nAhora puedes hacer clic o arrastrar el marcador para ajustar la ubicaci√≥n exacta del banco.`);
                }, 300);
            });
        }

        // SETUP DE SLIDERS
        function setupSliders() {
            const sliderInputs = document.querySelectorAll('.slider-input');
            
            sliderInputs.forEach(slider => {
                const id = slider.id;
                const valueDisplay = document.getElementById(`val-${id}`);
                const starsDisplay = document.getElementById(`stars-${id}`);
                const sliderGroup = slider.closest('.slider-group');

                function updateValue() {
                    const value = slider.value;
                    valueDisplay.textContent = value;
                    starsDisplay.textContent = generateStars(value);
                    
                    // Animar el n√∫mero
                    valueDisplay.style.transform = 'scale(1.2)';
                    setTimeout(() => {
                        valueDisplay.style.transform = 'scale(1)';
                    }, 200);
                    
                    // Animar las estrellas
                    starsDisplay.style.transform = 'scale(1.15) translateY(-2px)';
                    setTimeout(() => {
                        starsDisplay.style.transform = 'scale(1) translateY(0)';
                    }, 300);
                    
                    // Efecto visual en el grupo
                    sliderGroup.style.borderColor = '#4f46e5';
                    sliderGroup.style.boxShadow = '0 6px 16px rgba(79, 70, 229, 0.2)';
                    setTimeout(() => {
                        sliderGroup.style.borderColor = '#e0e7ff';
                        sliderGroup.style.boxShadow = '0 4px 12px rgba(79, 70, 229, 0.1)';
                    }, 400);
                }

                slider.addEventListener('input', updateValue);
                slider.addEventListener('change', updateValue);
                slider.addEventListener('touchmove', updateValue);
                
                updateValue();
            });
        }

        // MANEJO DE FOTOS
        function setupPhotoHandling() {
            const photoInput = document.getElementById('benchPhoto');
            const photoPreview = document.getElementById('photoPreview');
            const previewImage = document.getElementById('previewImage');
            const removePhotoBtn = document.getElementById('removePhotoBtn');
            const photoError = document.getElementById('photoError');

            photoInput.addEventListener('change', (e) => {
                const file = e.target.files[0];
                
                if (!file) {
                    selectedPhotoFile = null;
                    photoPreview.style.display = 'none';
                    photoError.style.display = 'none';
                    return;
                }

                const validTypes = ['image/jpeg', 'image/png', 'image/webp', 'image/gif'];
                if (!validTypes.includes(file.type)) {
                    photoError.textContent = '‚ùå Formato no permitido. Usa JPG, PNG, WebP o GIF';
                    photoError.style.display = 'block';
                    photoInput.value = '';
                    selectedPhotoFile = null;
                    return;
                }

                if (file.size > 5 * 1024 * 1024) {
                    photoError.textContent = '‚ùå Imagen muy grande. M√°ximo 5MB';
                    photoError.style.display = 'block';
                    photoInput.value = '';
                    selectedPhotoFile = null;
                    return;
                }

                selectedPhotoFile = file;
                const reader = new FileReader();
                reader.onload = (event) => {
                    previewImage.src = event.target.result;
                    photoPreview.style.display = 'block';
                    photoError.style.display = 'none';
                };
                reader.readAsDataURL(file);
            });

            removePhotoBtn.addEventListener('click', (e) => {
                e.preventDefault();
                selectedPhotoFile = null;
                photoInput.value = '';
                photoPreview.style.display = 'none';
                photoError.style.display = 'none';
            });
        }

        // INICIALIZACI√ìN GENERAL
        document.addEventListener('DOMContentLoaded', function() {
            console.log('üöÄ DOM Cargado - Inicializando formulario');
            setupAutoComplete();
            setupSliders();
            setupPhotoHandling();
            setupLocationSearch();
            initializeMap(40.4168, -3.7038, 13);
            
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition((position) => {
                    const lat = position.coords.latitude.toFixed(6);
                    const lng = position.coords.longitude.toFixed(6);
                    
                    console.log('üìç GPS detectado:', lat, lng);
                    
                    if (map && marker) {
                        marker.setLatLng([lat, lng]);
                        map.setView([lat, lng], 15);
                        updateMarkerPosition();
                    }
                }, (error) => {
                    console.warn('‚ö†Ô∏è GPS no disponible:', error.message);
                });
            }
        });
    </script>

    <!-- M√≥dulo de Firebase -->
    <script type="module">
        import { saveBench, uploadBenchPhoto, updateBench } from '../js/core/database.js';

        const form = document.getElementById('addBenchForm');
        form.addEventListener('submit', async (e) => {
            e.preventDefault();
            const btn = document.getElementById('saveBtn');
            const name = document.getElementById('benchName').value.trim();
            
            if (!name) {
                alert('‚ùå Por favor, ingresa el nombre del banco');
                return;
            }

            btn.disabled = true;
            btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Guardando...';

            try {
                const benchData = {
                    nombre: name,
                    descripcion: document.getElementById('benchDesc').value.trim(),
                    vistas: parseInt(document.getElementById('vistas').value),
                    privacidad: parseInt(document.getElementById('privacidad').value),
                    comodidad: parseInt(document.getElementById('comodidad').value),
                    atmosfera: parseInt(document.getElementById('atmosfera').value),
                    lat: parseFloat(document.getElementById('lat').value),
                    lng: parseFloat(document.getElementById('lng').value),
                    ciudad: document.getElementById('ciudad').value,
                    barrio: document.getElementById('barrio').value,
                    zona: document.getElementById('tipoZona').value,
                    etiquetas: ['Nuevo'],
                    fotoURL: null
                };

                const benchId = await saveBench(benchData);
                console.log('‚úÖ Banco creado:', benchId);

                if (window.selectedPhotoFile) {
                    btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Subiendo foto...';
                    const fotoURL = await uploadBenchPhoto(window.selectedPhotoFile, benchId);
                    await updateBench(benchId, { fotoURL });
                    alert('‚úÖ Banco agregado exitosamente con foto');
                } else {
                    alert('‚úÖ Banco agregado exitosamente');
                }
                window.location.href = 'map.html';
            } catch (error) {
                console.error('‚ùå Error:', error);
                alert('‚ùå Error: ' + (error.message || 'Error desconocido'));
            } finally {
                btn.disabled = false;
                btn.innerHTML = '<i class="fas fa-save"></i> Guardar Banco';
            }
        });
    </script>

</body>
</html>
